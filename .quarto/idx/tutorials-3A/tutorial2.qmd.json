{"title":"Practical 2 - Exome analysis (SNV calling)","markdown":{"yaml":{"Title":"Practical 2 - Exome analysis (SNV calling)"},"headingText":"Practical 2 - Exome analysis (SNV calling)","containsRefs":false,"markdown":"\n\n\n## Connection to the server\n\nTo learn how to connect to the server for practical work, refer to the [Server Connection Guide](../help/server_connection_guide.qmd).\n\nOnce you're connected, start by creating a working directory for this session and navigate into it.\n\nOnce connected, create a working directory for this session and move inside.\n\n**mkdir**\nThe mkdir command stands for \"make directory\", is used to create a new folder in the file system. You can create your directory like this:\n\n```bash\nmkdir <directory_name>\n```\n\n**cd**\nThe cd command stands for \"change directory\", allows you to move into a different folder within the file system. Use it as follows:\n\n```bash\ncd <directory>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir TdExome\ncd TdExome\n```\n:::\n\n::: {.callout-note}\n## Help\nIf you need help with a command, display its help using:\n - `<command-h` or `<command--help` for short help messages.\n - `man <command>` to display the full manual of a command.\n:::\n\n\n## Raw sequence data: exome of chromosome 22\n\nReads have been obtained using Illumina sequencing (Single-end library) from the exome of\nchromosome 22 of a single human individual, a Caucasian female from US. Her family was\none of the original trios in Hapmap project and she was part of the 1000 Genomes project.\n\nCreate an alias of the file with reads in your directory for easy access. For that, use the command `ln`, which create links between files. Links are pointers to files, allowing multiple references (aliases) to the same file. This way, you don't need to duplicate large files, saving storage space and making file management easier.\n\n```bash\nln -s <path_to_original_file> <path_to_link_file> \n``` \n\nThe option `-s`stands for \"symbolic link.\" A symbolic link is like a shortcut that points to the original file, enabling easy access. Unlike hard links, symbolic links can span different file systems, and if the original file is moved, the symbolic link can still point to it if it is relocated in the same system.\n\nCreate an alias for the reads (original path:`/data/human/reads/chrom22.fastq`) inside your directory.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nln -s /data/human/reads/chrom22.fastq .\n```\n\nThe dot (`.`) refers to the current working directory. When you execute the command, this tells the system to create the symbolic link (alias) for chrom22.fastq in the current directory where you are running the command.\n:::\n\nCreate a directory for the reference of chromosome 22 (original path: `/data/human/reference/human_genome.fasta`) and create an alias for the file.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir reference\nln -s /data/human/reference/human_genome.fasta reference\n```\n:::\n\nDisplay data with the command `more`.\n\nThe more command is used to display the contents of a file one screen at a time. This is useful for viewing large files like FASTQ files, where the data is too big to fit on a single screen.\n\n```bash\nmore <path_file_to_display>\n```\n\n::: {.callout-note}\n## Navigation keys in more\n\n- **space**: pressing the *space* key advances the display by one full screen, allowing you to scroll through the content quickly.\n- **enter**: Ppressing *enter* moves the display down by one line. This is useful if you want to slowly scroll through the content line by line.\n- **q**: pressing *q* will quit the more command and return you to the terminal prompt. You can use this key if you're done viewing the file or don't want to scroll through the entire file.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmore chrom22.fastq \n```\n:::\n\n**Q1.** How many lines are used to represent each read?\n\n**Q2.** How many sequences are present in `human_genome.fasta`? What do they correspond to? Use the command `grep` to display only the identifier lines.\n\n**grep**\n\nGrep, short for “global regular expression print”, is a command used for searching and matching text patterns in files contained in the regular expressions.\n\nDisplay the lines with a pattern:\n\n```bash\ngrep \"<pattern>\" <file_path>\n```\n\nThis command searches through the specified file and outputs the lines that contain the given pattern.\n\nCount the lines with a pattern:\n\n```bash\ngrep -c \"<pattern>\" <file_path>\n```\n\nThe -c option tells grep to count the number of lines that match the specified pattern rather than displaying them. This is useful for quickly determining how many occurrences of the pattern exist in the file.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\n# Display the identifier lines\ngrep \">\" reference/human_genome.fasta \n\n# Count the identifier lines\ngrep -c \">\" reference/human_genome.fasta \n```\n:::\n\n## FASTQ - Quality control\n\nUse the `fastqc` tool to assess the quality of the reads. Before running `fastqc`, create a directory to store the output reports (with `mkdir`command). \n\n**FastQC**\n\nFastQC is a quality control tool for high-throughput sequence data that provides an overview of various quality metrics, helping to identify potential issues with sequencing data.\n\n```bash\nfastqc -o <output_directory> <fastq_file>\n```\n\nThe option `-o <output_directory>` specifies the directory where the FastQC output files will be saved.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir FastQCReport\nfastqc -o FastQCReport chrom22.fastq\n```\n\n`fastcq` analyzes the file `chrom22.fastq` and saves the results in the `FastQCReport` directory.\n:::\n\nMove the HTML output files to your local computer to view the results in a browser. Use the `scp` command for this (in a local terminal).\n\n**scp**\nThe scp command stands for \"secure copy protocol.\" It is used to securely transfer files between a local computer and a remote server or between two remote servers over an encrypted SSH connection. This ensures that the data is protected during transfer.\n\nTo copy file from a server to your computer, **open a new terminal** and use scp like this:\n```bash\nscp <username>@<server_adress>:<source_file_path> <target_file_path>\n```\n\n::: {.callout-note}\n## View the path of a file\nIf you not sure of the path .html file, use the command `realpath` to known it.\n`realpath <file>` \n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nscp <username>@tp.lbgi.fr:~/TdExome/FastQCReport/chrom22_fastqc.html .\n```\n\n*Note: Replace `<login>` with your username. The tilde `~` is a shortcut for your home directory `/home/<username>`.*\n:::\n\nNow that the HTML file is on your computer, you can access it like any other file using your file explorer.\n\nIn the terminal where you used the `scp` command, run the `pwd` command to check your current directory. This will help you locate the file in your file explorer.\n\n**Q3.** How many sequences are available?\n\n**Q4.** What is the sequence length?\n\n**Q5.** Do you find poor quality sequences?\n\n**Q6.** What do you think of the overall data quality?\n\n**Q7.** Which part of the reads exhibit a lower quality?\n\n## Alignement - Mapping to the reference genome (FASTQ to BAM)\n### Alignment using Bowtie2\nBefore we can align sequencing reads to a reference genome, we must prepare the reference file using two key tools: `bwa index` and `samtools faidx`.\n\n**bwa index**: The bwa index command is used to create an index of the reference genome (in this case, human_genome.fasta). This index allows the BWA algorithm to efficiently search and align sequencing reads to the reference. Without the index, BWA would not be able to quickly identify where in the genome each read belongs, making the alignment process slow or impossible. The index is essential for speeding up the read mapping process.\n\n```bash\nbwa index <reference_file>\n```\n\n**samtools faidx**: Similarly, samtools faidx generates an index for the reference FASTA file. This index allows samtools and other bioinformatics tools to quickly retrieve specific sequences or regions from the reference genome. This is useful when working with large genomes where extracting specific chromosomes or regions manually would be inefficient. The .fai file generated by this command is used by downstream tools for fast reference lookups.\n\n```bash\nsamtools faidx <reference_file>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd reference\nbwa index human_genome.fasta\nsamtools faidx human_genome.fasta\ncd ..\n```\n::: \n\n::: {.callout-important}\n## Important\n\nThese commands may take some time to complete (one hour). To save time, you can use the ln command to create links to already generated files.\n\n```bash\nln -s /data/human/reference/human_genome.fasta.* reference/\n```\n:::\n\nYou get a lots of new files, forming a small database that you will use to align reads.\n\n::: {.callout-note}\n## Know where you are\nTo find out your current location within the directory structure, use the command `pwd` (stands for \"print working directory\"). It outputs the full path of the directory you are currently in, helping you confirm your current location in the file system. \n\n```bash\npwd\n```\n::: \n\n\n**bwa**\n\nCreate a mapping directory (at the same level as `reference` and `FastQCReport` directories), move there and run BWA with the **maximum exact matches (MEM)** algorithm. This algorithm is faster and more accurate than previous BWA algorithms for aligning high-throughput sequencing data.\n\nThe command `bwa mem` uses BWA use the MEM algorithm:\n\n```bash\nbwa mem -o <path_of_output> <path_of_reference> <path_of_reads>\n```\n\nParameters:\n\n- `-o`: This option specifies the output file. In this case, the aligned reads will be saved in the mapping directory as chrom22.sam.\n- `<path_of_reference>`: This is the reference genome file against which the reads will be aligned.\n- `<path_of_reads>`: This is the input file containing the sequencing reads that you want to align to the reference genome.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir mapping\nbwa mem -o mapping/chrom22.sam reference/human_genome.fasta chrom22.fastq\n```\n\n- `bwa mem`: use bwa with maximum exact matches (MEM) algorithm. \n- `-o`: option to specify the output file.\n:::\n\n**Q8.** View the file built by BWA.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmore mapping/chrom22.sam\n```\n:::\n\n**Q9.** What is the format of this file? What information can be found in it?\n\nTo manipulate the mapping file, we'll use [SAMtools](http://www.htslib.org/).\n\n**samtools view**\nThis command is specifically used to convert between these formats and to filter, extract, or manipulate alignments.\n\nTo transform SAM file into BAM use the command like this:\n\n```bash\nsamtools view -S -b -o <name_of_BAM_output> <name_of_SAM_input>\n```\n\nWith: \n\n- `-S`: indicate that the input file is in SAM format.\n- `-b`: tell samtools to output the result in BAM format.\n- `-o`: specify the name of the output file. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd mapping \nsamtools view -S -b -o chrom22.bam chrom22.sam \n```\n:::\n\n**Q10.** What does the BAM file represent in relation to the SAM file?\n\n**ls**\n\nThe `ls` command is used to list the contents of a directory in Linux. It provides a way to see files and subdirectories within the specified directory.\n\n```bash\nls [-l] <directory>\n```\nOptions:\n\n- `-l`: This option provides a detailed listing. In this format, additional information about each file or directory is displayed, including:\n    1. File permissions\n    2. Number of links\n    3. Owner name\n    4. Owner group\n    5. File size (in bytes)\n    6. Last modified date and time\n    7. File or directory name\n\n**Q11.** Compare the size of the SAM and BAM files. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nls -l \n```\n:::\n\nThe file now needs to be sorted and indexed with `samtools sort` and `samtools index`.\n\n**samtools sort**\n\nThe samtools sort command is used to sort a BAM file. Sorting is essential for many downstream analyses, such as variant calling, as it organizes the reads in a way that allows for efficient processing. The command takes the following parameters:\n\n```bash\nsamtools sort <name_of_BAM_file> -o <name_of_sorted_BAM_file>\n```\n\n**samtools index**\n\nThe samtools index command is used to create an index file for a sorted BAM file. Indexing allows for fast random access to data in the BAM file, making it easier and quicker to retrieve specific regions of interest during analysis. The command takes the following parameter:\n\n```bash\nsamtools index <name_of_sorted_BAM_file>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools sort chrom22.bam -o chrom22.sorted.bam\nsamtools index chrom22.sorted.bam\n```\n:::\n\n**Q12.** How is the file sorted now? To view its contents, use the command `samtools view`.\n\n```bash\nsamtools view <file_name> | more\n```\n\nThe **pipe** symbol (`|`) is used to connect the output of one command directly into the input of another. This allows for the chaining of commands, enabling you to perform complex tasks efficiently without the need to create intermediate files.\n\n```bash\ncommand1 | command2\n```\n::: {.callout-note}\n## Pipe Shortcut\n- Windows and Linux: `Alt Gr + 6`\n- Mac keyboard: `Option + Maj + L`\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools view chrom22.sorted.bam | more\n```\n:::\n\nTo view few statistics about the mapping, use idxStats:\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools idxstats chrom22.sorted.bam\n```\n:::\n\n**Q13.** How do you explain these results?\n\nSelect the part of the alignment corresponding to chromosome 3. To filter the file, use again the command `samtools view` but add the region.\n\n```bash\nsamtools view -b -o <name_of_BAM_output> <name_of_BAM_input> <region>\n```\n\n- `-b`: This option indicates that the output should be in BAM format.\n- `-o <name_of_BAM_output>`: This specifies the name of the output BAM file.\n- `<name_of_BAM_input>`: This is the name of the input BAM file you want to filter.\n- `<region>`: Specify the region you want to extract, such as `chr3` or `chr3:1-1000000` to limit the output to a specific range on chromosome 3.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools view -b -o chrom22.sorted.filter.bam chrom22.sorted.bam chr22\n```\n:::\n\nThen index this file with `samtools index` as previously.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools index chrom22.sorted.filter.bam\n```\n:::\n\nDownload the two 2 bam files of the alignment of chromosome 22 (the `.bam` and the `.bam.bai`).\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nscp <login>@tp.lbgi.fr:~/TdExome/mapping/chrom22.sorted.filter.bam* .\n```\n\n*Note: Replace `<login>` with your username. The tilde `~` is a shortcut for your home directory `/home/<username>`.*\n:::\n\n### Visualization of the BAM file\nBAM files can be visualized using a browser. Display the filtered BAM data using [IGV](https://igv.org/app/) with Human hg38.\n\nYou can use your own files or used files available online.\n- Load the bam file `chr22_filter.bam` and `chr22_filter.bai` with Local (Tracks > Local). \n- Load the bam file https://lbgi.fr/~merlat/TD3/chr22_filter.bam & the index file https://lbgi.fr/~merlat/TD3/chr22_filter.bai with URL (Tracks > URL). \n\nZoom in to display a small region of chromosome 22 (or a gene such as APOL5). Configure the display to highlight mismatches.\n\n**Q14.** Are reads exclusively mapped on exonic regions? Why?\n\n**Q15.** Do you think that all observed mismatches correspond to variants?\n\n**Q16.** What criteria have to be fulfilled to infer variants?\n\n## Calling single nucleotide variations (SNVs) – pileup, interval and BED files\n\n### Generation of a Pileup file\n\nAt the same level as `reference`, `FastQCReport` and `mapping` directories, create a directory `variantCalling`.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd ..\nmkdir variantCalling\n```\n\nA pileup is a column wise representation of the aligned read - at the base level - to the reference. The pileup file summarizes all data from the reads at each genomic region that is covered by at least one read.\n\nTo generate a pileup file using SAMtools, use `samtools mpileup` command with the specified options.\n\n**samtools mpileup**\n\n- `-f reference.fasta`: Specifies the reference genome file.\n- `aligned_reads.bam`: Your input BAM file with aligned reads.\n- `output.pileup`: The name of the output pileup file.\n\n```bash\nsamtools mpileup -f <reference_file> -C <value> <bam_file> > <pileup_output>\n```\n\nParameters: \n\n- `-f <reference_file>`: Specifies the reference genome file to which the reads are aligned.\n- `-C`: Adjusts the mapping quality. It allows to reduce the impact of mismapped reads on the pileup by reducing their quality score.\n- `<bam_file>`: The input BAM file that contains the aligned reads. It must be sorted and indexed for efficient querying.\n- `>`: Redirects the standard output (stdout) to a file, saving the results of the command into the specified file rather than displaying them in the terminal.\n- `<pileup_output>`: This writes the output to the specified pileup file.\n\n\nGenerate the pileup file and adjust the mapping quality to 50. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools mpileup -f reference/human_genome.fasta -C 50 aligned_reads.bam > variantCalling/chrom22.pileup\n```\n:::\n\nSearch online for the significance of each column.\n\n### Filtering pileup to get a list of SNVs\n\nThe pileup described all aligned positions. To call SNVs, we have to filter:\n\n- Aligned positions that differ from the reference base\n- Positions covered by minimum amount of reads (e.g. at least 10 reads)\n- Sites with variants with sufficient quality base scores\n\n#### First filter: depth of coverage and read base quality\n\nThis command generates an interval format file.\n\n```bash\nperl /bin/pileup_parser.pl <input_pileup> <ref_base_column> <read_bases_column> <base_quality_column> <coverage column> <qv cutoff> <coverage cutoff> <SNPs only?> <output bed?> <coord_column> <out_file> <total_diff> <print_qual_bases>\n```\n\nArguments: \n\n- `<input_pileup>`: Path to your input pileup file.\n- `<ref_base_column>`: The column index (starting from 1) of the reference nucleotide.\n- `<read_bases_column>`: The column index of the bases at that position from aligned reads.\n- `<base_quality_column>`: The column index of the Phred quality.\n- `<coverage_column>`: The column index of the depth of coverage.\n- `<qv_cutoff>`: Quality value cutoff.\n- `<coverage_cutoff>`: Coverage cutoff.\n- `<SNPs_only>`: If you only want SNPs (yes/no).\n- `<output_bed>`: If you want to output in BED format (yes/no).\n- `<coord_column>`: The coordinate system.\n- `<out_file>`: Path where you want to save the output (e.g., output.txt).\n- `<total_diff>`: If you want to print the total number of differences (yes/no).\n- `<print_qual_bases>`: If you want to print the quality bases (yes/no).\n\nUse this command to parse the pileup file by filling with the correct columns and the folowing options: \n- Do not consider read bases with quality lower than = **20**.\n- Do not report positions with coverage lower than = **10**.\n- Only SNPs.\n- Do not produce a output in BED format. \n- Use the coordinate system 2.\n- Do not print the total number of difference.\n- Print the quality bases.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd variantCalling/\n/bin/pileup_parser.pl chrom22.pileup 3 5 6 4 20 10 Yes No 2 chrom22.pileup.parsed No Yes\n```\n\n**Q17.** How many regions do you obtain? Use the command `wc -l` to count the number of lines. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nwc -l chrom22.pileup.parsed \n```\n\n#### Second filter: SNV quality (>50)\n\nIn the interval file, SNV quality is indicated in column 7. Use awk to keep only lines where column 7 > 50, combine with wc -l to count the number of keeped lines.\n\n**Q18.** How many reliable SNVs have been called? Use awk to keep only lines where column 7 > 50, combine with wc -l to count the number of keeped lines.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nawk '$7 > 50'  chrom22.pileup.parsed2 |wc -l\n```\n\n## Annotation of variants\nGo to Variant Effect Predictor : http://grch37.ensembl.org/Homo_sapiens/Tools/VEP\n\nClick on Ensembl default below the white frame for input data\n\nPaste the URL : http://lbgi.fr/~weber/GC/TD3/2_VCF/chr22_filter.vcf.gz corresponding to the chr22 VCF file in the URL field.\nSelect the following options :\n- Transcript database to use\n- RefSeq transcripts\n- Additional configuration\n- Variants and frequency data\n- Frequency data for co-located variants:s\n- **DISABLE** 1000 Genomes global minor allele frequency\n- **ENABLE** gnomAD (exomes) allele frequencies\n- Predictions\n- Pathogenicity predictions\n- **ENABLE** CADD\n- Filtering options\n- Filters\n- Restrict results: Show one selected consequence per gene\n\nThen RUN !\n\n**Q17.** How many missense variants are there in this file ? (approximately)\n\nCreate a filter to select only missense_variant (Consequence is missense_variant)\n\nFocus on 22:23482483-23482483.\n\n**Q15.** On which gene is the variant ? Which exon ?\n\n**Q15.** Why is this variant difficult to interpret ? (MAF, scores)\n\n**Q15.** Bonus : is the variant referenced in ClinVar ?","srcMarkdownNoYaml":"\n\n# Practical 2 - Exome analysis (SNV calling)\n\n## Connection to the server\n\nTo learn how to connect to the server for practical work, refer to the [Server Connection Guide](../help/server_connection_guide.qmd).\n\nOnce you're connected, start by creating a working directory for this session and navigate into it.\n\nOnce connected, create a working directory for this session and move inside.\n\n**mkdir**\nThe mkdir command stands for \"make directory\", is used to create a new folder in the file system. You can create your directory like this:\n\n```bash\nmkdir <directory_name>\n```\n\n**cd**\nThe cd command stands for \"change directory\", allows you to move into a different folder within the file system. Use it as follows:\n\n```bash\ncd <directory>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir TdExome\ncd TdExome\n```\n:::\n\n::: {.callout-note}\n## Help\nIf you need help with a command, display its help using:\n - `<command-h` or `<command--help` for short help messages.\n - `man <command>` to display the full manual of a command.\n:::\n\n\n## Raw sequence data: exome of chromosome 22\n\nReads have been obtained using Illumina sequencing (Single-end library) from the exome of\nchromosome 22 of a single human individual, a Caucasian female from US. Her family was\none of the original trios in Hapmap project and she was part of the 1000 Genomes project.\n\nCreate an alias of the file with reads in your directory for easy access. For that, use the command `ln`, which create links between files. Links are pointers to files, allowing multiple references (aliases) to the same file. This way, you don't need to duplicate large files, saving storage space and making file management easier.\n\n```bash\nln -s <path_to_original_file> <path_to_link_file> \n``` \n\nThe option `-s`stands for \"symbolic link.\" A symbolic link is like a shortcut that points to the original file, enabling easy access. Unlike hard links, symbolic links can span different file systems, and if the original file is moved, the symbolic link can still point to it if it is relocated in the same system.\n\nCreate an alias for the reads (original path:`/data/human/reads/chrom22.fastq`) inside your directory.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nln -s /data/human/reads/chrom22.fastq .\n```\n\nThe dot (`.`) refers to the current working directory. When you execute the command, this tells the system to create the symbolic link (alias) for chrom22.fastq in the current directory where you are running the command.\n:::\n\nCreate a directory for the reference of chromosome 22 (original path: `/data/human/reference/human_genome.fasta`) and create an alias for the file.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir reference\nln -s /data/human/reference/human_genome.fasta reference\n```\n:::\n\nDisplay data with the command `more`.\n\nThe more command is used to display the contents of a file one screen at a time. This is useful for viewing large files like FASTQ files, where the data is too big to fit on a single screen.\n\n```bash\nmore <path_file_to_display>\n```\n\n::: {.callout-note}\n## Navigation keys in more\n\n- **space**: pressing the *space* key advances the display by one full screen, allowing you to scroll through the content quickly.\n- **enter**: Ppressing *enter* moves the display down by one line. This is useful if you want to slowly scroll through the content line by line.\n- **q**: pressing *q* will quit the more command and return you to the terminal prompt. You can use this key if you're done viewing the file or don't want to scroll through the entire file.\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmore chrom22.fastq \n```\n:::\n\n**Q1.** How many lines are used to represent each read?\n\n**Q2.** How many sequences are present in `human_genome.fasta`? What do they correspond to? Use the command `grep` to display only the identifier lines.\n\n**grep**\n\nGrep, short for “global regular expression print”, is a command used for searching and matching text patterns in files contained in the regular expressions.\n\nDisplay the lines with a pattern:\n\n```bash\ngrep \"<pattern>\" <file_path>\n```\n\nThis command searches through the specified file and outputs the lines that contain the given pattern.\n\nCount the lines with a pattern:\n\n```bash\ngrep -c \"<pattern>\" <file_path>\n```\n\nThe -c option tells grep to count the number of lines that match the specified pattern rather than displaying them. This is useful for quickly determining how many occurrences of the pattern exist in the file.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\n# Display the identifier lines\ngrep \">\" reference/human_genome.fasta \n\n# Count the identifier lines\ngrep -c \">\" reference/human_genome.fasta \n```\n:::\n\n## FASTQ - Quality control\n\nUse the `fastqc` tool to assess the quality of the reads. Before running `fastqc`, create a directory to store the output reports (with `mkdir`command). \n\n**FastQC**\n\nFastQC is a quality control tool for high-throughput sequence data that provides an overview of various quality metrics, helping to identify potential issues with sequencing data.\n\n```bash\nfastqc -o <output_directory> <fastq_file>\n```\n\nThe option `-o <output_directory>` specifies the directory where the FastQC output files will be saved.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir FastQCReport\nfastqc -o FastQCReport chrom22.fastq\n```\n\n`fastcq` analyzes the file `chrom22.fastq` and saves the results in the `FastQCReport` directory.\n:::\n\nMove the HTML output files to your local computer to view the results in a browser. Use the `scp` command for this (in a local terminal).\n\n**scp**\nThe scp command stands for \"secure copy protocol.\" It is used to securely transfer files between a local computer and a remote server or between two remote servers over an encrypted SSH connection. This ensures that the data is protected during transfer.\n\nTo copy file from a server to your computer, **open a new terminal** and use scp like this:\n```bash\nscp <username>@<server_adress>:<source_file_path> <target_file_path>\n```\n\n::: {.callout-note}\n## View the path of a file\nIf you not sure of the path .html file, use the command `realpath` to known it.\n`realpath <file>` \n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nscp <username>@tp.lbgi.fr:~/TdExome/FastQCReport/chrom22_fastqc.html .\n```\n\n*Note: Replace `<login>` with your username. The tilde `~` is a shortcut for your home directory `/home/<username>`.*\n:::\n\nNow that the HTML file is on your computer, you can access it like any other file using your file explorer.\n\nIn the terminal where you used the `scp` command, run the `pwd` command to check your current directory. This will help you locate the file in your file explorer.\n\n**Q3.** How many sequences are available?\n\n**Q4.** What is the sequence length?\n\n**Q5.** Do you find poor quality sequences?\n\n**Q6.** What do you think of the overall data quality?\n\n**Q7.** Which part of the reads exhibit a lower quality?\n\n## Alignement - Mapping to the reference genome (FASTQ to BAM)\n### Alignment using Bowtie2\nBefore we can align sequencing reads to a reference genome, we must prepare the reference file using two key tools: `bwa index` and `samtools faidx`.\n\n**bwa index**: The bwa index command is used to create an index of the reference genome (in this case, human_genome.fasta). This index allows the BWA algorithm to efficiently search and align sequencing reads to the reference. Without the index, BWA would not be able to quickly identify where in the genome each read belongs, making the alignment process slow or impossible. The index is essential for speeding up the read mapping process.\n\n```bash\nbwa index <reference_file>\n```\n\n**samtools faidx**: Similarly, samtools faidx generates an index for the reference FASTA file. This index allows samtools and other bioinformatics tools to quickly retrieve specific sequences or regions from the reference genome. This is useful when working with large genomes where extracting specific chromosomes or regions manually would be inefficient. The .fai file generated by this command is used by downstream tools for fast reference lookups.\n\n```bash\nsamtools faidx <reference_file>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd reference\nbwa index human_genome.fasta\nsamtools faidx human_genome.fasta\ncd ..\n```\n::: \n\n::: {.callout-important}\n## Important\n\nThese commands may take some time to complete (one hour). To save time, you can use the ln command to create links to already generated files.\n\n```bash\nln -s /data/human/reference/human_genome.fasta.* reference/\n```\n:::\n\nYou get a lots of new files, forming a small database that you will use to align reads.\n\n::: {.callout-note}\n## Know where you are\nTo find out your current location within the directory structure, use the command `pwd` (stands for \"print working directory\"). It outputs the full path of the directory you are currently in, helping you confirm your current location in the file system. \n\n```bash\npwd\n```\n::: \n\n\n**bwa**\n\nCreate a mapping directory (at the same level as `reference` and `FastQCReport` directories), move there and run BWA with the **maximum exact matches (MEM)** algorithm. This algorithm is faster and more accurate than previous BWA algorithms for aligning high-throughput sequencing data.\n\nThe command `bwa mem` uses BWA use the MEM algorithm:\n\n```bash\nbwa mem -o <path_of_output> <path_of_reference> <path_of_reads>\n```\n\nParameters:\n\n- `-o`: This option specifies the output file. In this case, the aligned reads will be saved in the mapping directory as chrom22.sam.\n- `<path_of_reference>`: This is the reference genome file against which the reads will be aligned.\n- `<path_of_reads>`: This is the input file containing the sequencing reads that you want to align to the reference genome.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmkdir mapping\nbwa mem -o mapping/chrom22.sam reference/human_genome.fasta chrom22.fastq\n```\n\n- `bwa mem`: use bwa with maximum exact matches (MEM) algorithm. \n- `-o`: option to specify the output file.\n:::\n\n**Q8.** View the file built by BWA.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nmore mapping/chrom22.sam\n```\n:::\n\n**Q9.** What is the format of this file? What information can be found in it?\n\nTo manipulate the mapping file, we'll use [SAMtools](http://www.htslib.org/).\n\n**samtools view**\nThis command is specifically used to convert between these formats and to filter, extract, or manipulate alignments.\n\nTo transform SAM file into BAM use the command like this:\n\n```bash\nsamtools view -S -b -o <name_of_BAM_output> <name_of_SAM_input>\n```\n\nWith: \n\n- `-S`: indicate that the input file is in SAM format.\n- `-b`: tell samtools to output the result in BAM format.\n- `-o`: specify the name of the output file. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd mapping \nsamtools view -S -b -o chrom22.bam chrom22.sam \n```\n:::\n\n**Q10.** What does the BAM file represent in relation to the SAM file?\n\n**ls**\n\nThe `ls` command is used to list the contents of a directory in Linux. It provides a way to see files and subdirectories within the specified directory.\n\n```bash\nls [-l] <directory>\n```\nOptions:\n\n- `-l`: This option provides a detailed listing. In this format, additional information about each file or directory is displayed, including:\n    1. File permissions\n    2. Number of links\n    3. Owner name\n    4. Owner group\n    5. File size (in bytes)\n    6. Last modified date and time\n    7. File or directory name\n\n**Q11.** Compare the size of the SAM and BAM files. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nls -l \n```\n:::\n\nThe file now needs to be sorted and indexed with `samtools sort` and `samtools index`.\n\n**samtools sort**\n\nThe samtools sort command is used to sort a BAM file. Sorting is essential for many downstream analyses, such as variant calling, as it organizes the reads in a way that allows for efficient processing. The command takes the following parameters:\n\n```bash\nsamtools sort <name_of_BAM_file> -o <name_of_sorted_BAM_file>\n```\n\n**samtools index**\n\nThe samtools index command is used to create an index file for a sorted BAM file. Indexing allows for fast random access to data in the BAM file, making it easier and quicker to retrieve specific regions of interest during analysis. The command takes the following parameter:\n\n```bash\nsamtools index <name_of_sorted_BAM_file>\n```\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools sort chrom22.bam -o chrom22.sorted.bam\nsamtools index chrom22.sorted.bam\n```\n:::\n\n**Q12.** How is the file sorted now? To view its contents, use the command `samtools view`.\n\n```bash\nsamtools view <file_name> | more\n```\n\nThe **pipe** symbol (`|`) is used to connect the output of one command directly into the input of another. This allows for the chaining of commands, enabling you to perform complex tasks efficiently without the need to create intermediate files.\n\n```bash\ncommand1 | command2\n```\n::: {.callout-note}\n## Pipe Shortcut\n- Windows and Linux: `Alt Gr + 6`\n- Mac keyboard: `Option + Maj + L`\n:::\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools view chrom22.sorted.bam | more\n```\n:::\n\nTo view few statistics about the mapping, use idxStats:\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools idxstats chrom22.sorted.bam\n```\n:::\n\n**Q13.** How do you explain these results?\n\nSelect the part of the alignment corresponding to chromosome 3. To filter the file, use again the command `samtools view` but add the region.\n\n```bash\nsamtools view -b -o <name_of_BAM_output> <name_of_BAM_input> <region>\n```\n\n- `-b`: This option indicates that the output should be in BAM format.\n- `-o <name_of_BAM_output>`: This specifies the name of the output BAM file.\n- `<name_of_BAM_input>`: This is the name of the input BAM file you want to filter.\n- `<region>`: Specify the region you want to extract, such as `chr3` or `chr3:1-1000000` to limit the output to a specific range on chromosome 3.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools view -b -o chrom22.sorted.filter.bam chrom22.sorted.bam chr22\n```\n:::\n\nThen index this file with `samtools index` as previously.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools index chrom22.sorted.filter.bam\n```\n:::\n\nDownload the two 2 bam files of the alignment of chromosome 22 (the `.bam` and the `.bam.bai`).\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nscp <login>@tp.lbgi.fr:~/TdExome/mapping/chrom22.sorted.filter.bam* .\n```\n\n*Note: Replace `<login>` with your username. The tilde `~` is a shortcut for your home directory `/home/<username>`.*\n:::\n\n### Visualization of the BAM file\nBAM files can be visualized using a browser. Display the filtered BAM data using [IGV](https://igv.org/app/) with Human hg38.\n\nYou can use your own files or used files available online.\n- Load the bam file `chr22_filter.bam` and `chr22_filter.bai` with Local (Tracks > Local). \n- Load the bam file https://lbgi.fr/~merlat/TD3/chr22_filter.bam & the index file https://lbgi.fr/~merlat/TD3/chr22_filter.bai with URL (Tracks > URL). \n\nZoom in to display a small region of chromosome 22 (or a gene such as APOL5). Configure the display to highlight mismatches.\n\n**Q14.** Are reads exclusively mapped on exonic regions? Why?\n\n**Q15.** Do you think that all observed mismatches correspond to variants?\n\n**Q16.** What criteria have to be fulfilled to infer variants?\n\n## Calling single nucleotide variations (SNVs) – pileup, interval and BED files\n\n### Generation of a Pileup file\n\nAt the same level as `reference`, `FastQCReport` and `mapping` directories, create a directory `variantCalling`.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd ..\nmkdir variantCalling\n```\n\nA pileup is a column wise representation of the aligned read - at the base level - to the reference. The pileup file summarizes all data from the reads at each genomic region that is covered by at least one read.\n\nTo generate a pileup file using SAMtools, use `samtools mpileup` command with the specified options.\n\n**samtools mpileup**\n\n- `-f reference.fasta`: Specifies the reference genome file.\n- `aligned_reads.bam`: Your input BAM file with aligned reads.\n- `output.pileup`: The name of the output pileup file.\n\n```bash\nsamtools mpileup -f <reference_file> -C <value> <bam_file> > <pileup_output>\n```\n\nParameters: \n\n- `-f <reference_file>`: Specifies the reference genome file to which the reads are aligned.\n- `-C`: Adjusts the mapping quality. It allows to reduce the impact of mismapped reads on the pileup by reducing their quality score.\n- `<bam_file>`: The input BAM file that contains the aligned reads. It must be sorted and indexed for efficient querying.\n- `>`: Redirects the standard output (stdout) to a file, saving the results of the command into the specified file rather than displaying them in the terminal.\n- `<pileup_output>`: This writes the output to the specified pileup file.\n\n\nGenerate the pileup file and adjust the mapping quality to 50. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nsamtools mpileup -f reference/human_genome.fasta -C 50 aligned_reads.bam > variantCalling/chrom22.pileup\n```\n:::\n\nSearch online for the significance of each column.\n\n### Filtering pileup to get a list of SNVs\n\nThe pileup described all aligned positions. To call SNVs, we have to filter:\n\n- Aligned positions that differ from the reference base\n- Positions covered by minimum amount of reads (e.g. at least 10 reads)\n- Sites with variants with sufficient quality base scores\n\n#### First filter: depth of coverage and read base quality\n\nThis command generates an interval format file.\n\n```bash\nperl /bin/pileup_parser.pl <input_pileup> <ref_base_column> <read_bases_column> <base_quality_column> <coverage column> <qv cutoff> <coverage cutoff> <SNPs only?> <output bed?> <coord_column> <out_file> <total_diff> <print_qual_bases>\n```\n\nArguments: \n\n- `<input_pileup>`: Path to your input pileup file.\n- `<ref_base_column>`: The column index (starting from 1) of the reference nucleotide.\n- `<read_bases_column>`: The column index of the bases at that position from aligned reads.\n- `<base_quality_column>`: The column index of the Phred quality.\n- `<coverage_column>`: The column index of the depth of coverage.\n- `<qv_cutoff>`: Quality value cutoff.\n- `<coverage_cutoff>`: Coverage cutoff.\n- `<SNPs_only>`: If you only want SNPs (yes/no).\n- `<output_bed>`: If you want to output in BED format (yes/no).\n- `<coord_column>`: The coordinate system.\n- `<out_file>`: Path where you want to save the output (e.g., output.txt).\n- `<total_diff>`: If you want to print the total number of differences (yes/no).\n- `<print_qual_bases>`: If you want to print the quality bases (yes/no).\n\nUse this command to parse the pileup file by filling with the correct columns and the folowing options: \n- Do not consider read bases with quality lower than = **20**.\n- Do not report positions with coverage lower than = **10**.\n- Only SNPs.\n- Do not produce a output in BED format. \n- Use the coordinate system 2.\n- Do not print the total number of difference.\n- Print the quality bases.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\ncd variantCalling/\n/bin/pileup_parser.pl chrom22.pileup 3 5 6 4 20 10 Yes No 2 chrom22.pileup.parsed No Yes\n```\n\n**Q17.** How many regions do you obtain? Use the command `wc -l` to count the number of lines. \n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nwc -l chrom22.pileup.parsed \n```\n\n#### Second filter: SNV quality (>50)\n\nIn the interval file, SNV quality is indicated in column 7. Use awk to keep only lines where column 7 > 50, combine with wc -l to count the number of keeped lines.\n\n**Q18.** How many reliable SNVs have been called? Use awk to keep only lines where column 7 > 50, combine with wc -l to count the number of keeped lines.\n\n::: {.callout-tip collapse=\"true\"}\n## Solution\n```bash\nawk '$7 > 50'  chrom22.pileup.parsed2 |wc -l\n```\n\n## Annotation of variants\nGo to Variant Effect Predictor : http://grch37.ensembl.org/Homo_sapiens/Tools/VEP\n\nClick on Ensembl default below the white frame for input data\n\nPaste the URL : http://lbgi.fr/~weber/GC/TD3/2_VCF/chr22_filter.vcf.gz corresponding to the chr22 VCF file in the URL field.\nSelect the following options :\n- Transcript database to use\n- RefSeq transcripts\n- Additional configuration\n- Variants and frequency data\n- Frequency data for co-located variants:s\n- **DISABLE** 1000 Genomes global minor allele frequency\n- **ENABLE** gnomAD (exomes) allele frequencies\n- Predictions\n- Pathogenicity predictions\n- **ENABLE** CADD\n- Filtering options\n- Filters\n- Restrict results: Show one selected consequence per gene\n\nThen RUN !\n\n**Q17.** How many missense variants are there in this file ? (approximately)\n\nCreate a filter to select only missense_variant (Consequence is missense_variant)\n\nFocus on 22:23482483-23482483.\n\n**Q15.** On which gene is the variant ? Which exon ?\n\n**Q15.** Why is this variant difficult to interpret ? (MAF, scores)\n\n**Q15.** Bonus : is the variant referenced in ClinVar ?"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../styles.css"],"toc":true,"output-file":"tutorial2.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.5.56","theme":{"light":"flatly","dark":"darkly"},"Title":"Practical 2 - Exome analysis (SNV calling)"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}